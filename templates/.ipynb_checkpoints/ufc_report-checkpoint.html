<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
      <link rel="stylesheet" type='text/css' href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css" />
      <link rel="stylesheet" type='text/css' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" />
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <title>{{ title }}</title>
      <style>
         header {
         background-color: #000;
         color: #fff;
         }
         header img {
         height: 60px;
         }
         .intro {
         background-color: #f8f9fa;
         border-left: 5px solid #dc3545;
         }
      </style>
   </head>
   <body>
      <!-- Header -->
      <header class="py-3 shadow-sm">
         <div class="container d-flex align-items-center">
            <img src="{{ ufc_logo_url }}" alt="UFC Logo" class="me-3">
            <h1 class="h3 mb-0">{{ title }}</h1>
         </div>
      </header>
      <!-- Main container -->
      <div class="container my-4">
         <!-- Meta info -->
         <p class="text-muted small mb-4">
            <strong>Processed on:</strong> {{ processed_date }}
         </p>
         <!-- Intro section -->
         <div class="intro p-4 mb-4 rounded shadow-sm">
            <p class="mb-3">
               This report presents a detailed analysis of UFC fight data, exploring relevant statistics, trends, and insights.
               The goal is to understand performance patterns, fighting styles, and results over time.
            </p>
            <div class="d-flex flex-wrap gap-2">
               <a href="{{ kaggle_link }}" target="_blank" class="btn btn-outline-primary btn-sm">
               <i class="devicon-kaggle-original"></i> Kaggle Dataset
               </a>
               <a href="{{ github_link }}" target="_blank" class="btn btn-outline-dark btn-sm">
               <i class="devicon-github-original"></i> GitHub Codebase
               </a>
            </div>
         </div>
         <hr class="my-4">
         <!-- UFC Historical Overview Section -->
         <section class="mb-5">
            <h2 class="mb-4">
               <i class="fas fa-history text-danger"></i> UFC Historical Overview
            </h2>
            <!-- Evolution of the number of fights per year -->
            <div class="mb-5">
               <h4 class="mb-3">
                  <i class="fas fa-chart-line text-primary"></i> Evolution of the number of fights per year
               </h4>
               <div class="text-center">
                  <img src="images/chart-1.png" alt="Evolution of fights per year" class="img-fluid rounded shadow-sm">
                  <p class="text-muted small mt-2">Figure 1: Number of UFC fights per year (historical trend)</p>
               </div>
            </div>
            <!-- Most frequent host countries and cities -->
            <div class="mb-5">
               <h4 class="mb-3">
                  <i class="fas fa-map-marker-alt text-success"></i> Most frequent host countries and cities
               </h4>
               <!-- Countries -->
               <div class="mb-4">
                  <p>
                     Over the years, UFC has hosted events in multiple countries, but certain nations have dominated the scene.
                     Below are the top host countries by number of events.
                  </p>
                  <!-- Example table -->
                  <table class="table table-striped table-bordered table-sm">
                     <thead class="table-dark">
                        <tr>
                           <th>Rank</th>
                           <th>Country</th>
                           <th>Events Hosted</th>
                        </tr>
                     </thead>
                     <tbody>
                        {% set ns = namespace(index_cnt = 1) -%}
                        {% for country in countries.keys() -%}
                        <tr>
                           <td>{{ ns.index_cnt }}</td>
                           <td>{{ country }}</td>
                           <td>{{ countries[country] }}</td>
                           {% set ns.index_cnt = ns.index_cnt + 1 %}
                        </tr>
                        {% endfor %}
                     </tbody>
                  </table>
               </div>
               <!-- Cities -->
               <div>
                  <p>
                     These are the top 5 cities with the most UFC events.
                  </p>
                  <div class="row g-4">
                     {% set ns = namespace(index_cnt = 1) -%}
                     {% for city in cities.keys() -%}
                     <div class="col-6 col-md-4 col-lg-2 text-center">
                        <img src="images/city{{ns.index_cnt}}.jpg" alt="{{ city }}" class="img-fluid rounded shadow-sm"">
                        <p class="mt-2 mb-0 fw-bold">{{ city }}</p>
                        <p class="mt-2 mb-0 fw-bold">{{ cities[city] }} events</p>
                     </div>
                     {% set ns.index_cnt = ns.index_cnt + 1 %}
                     {% endfor %}
                  </div>
               </div>
            </div>
            <!-- Distribution of fights per weight class over time -->
            <div>
               <h4 class="mb-3">
                  <i class="fas fa-dumbbell text-warning"></i> Distribution of fights per weight class over time
               </h4>
               <p>
                  The graph below shows how fights have been distributed across weight classes throughout UFC history.
               </p>
               <div class="text-center">
                  <div>
                     <canvas id="distFightsPerWeightChart"></canvas>
                  </div>
                  <p class="text-muted small mt-2">Figure 2: Weight class distribution over time</p>
               </div>
            </div>
         </section>
          <!-- General Fight Statistics -->
        <section class="mb-5">
            <h2 class="mb-4">
                <i class="fas fa-chart-pie text-danger"></i> General Fight Statistics
            </h2>
        
            <!-- Win ratio by method -->
            <div class="mb-5">
                <h4 class="mb-3">
                    <i class="fas fa-trophy text-warning"></i> Win ratio by method
                </h4>
                <p>
                    This chart shows the proportion of fight outcomes by method — Knockout/Technical Knockout (KO/TKO), Submission, and Decision.
                </p>
                <div class="row align-items-center">
                    <div class="col-md-6 text-center">
                        <canvas id="winRatioChart" style="max-height: 300px;"></canvas>
                        <p class="text-muted small mt-2">Figure 3: Win ratio distribution</p>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-group shadow-sm">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-hand-rock text-success"></i> KO/TKO</span>
                                <span class="badge bg-success rounded-pill">{{ ko_submission_decision_methods_props[1] }}%</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-link text-primary"></i> Submission</span>
                                <span class="badge bg-primary rounded-pill">{{ ko_submission_decision_methods_props[2] }}%</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-clipboard-check text-danger"></i> Decision</span>
                                <span class="badge bg-danger rounded-pill">{{ ko_submission_decision_methods_props[0] }}%</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Average fight duration per weight class -->
            <div class="mb-5">
                <h4 class="mb-3">
                    <i class="fas fa-stopwatch text-info"></i> Average fight duration per weight class
                </h4>
                <p>
                    This table shows the average fight duration for each weight class.  
                    The bars visually represent the relative length of the fights.
                </p>
                <table class="table table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Weight Class</th>
                            <th>Average Duration (seconds)</th>
                            <th>Visual</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set max_val = duration_by_weight_class.values() | max %}
                        {% for weight_class, seconds in duration_by_weight_class.items() %}
                        <tr>
                            <td>{{ weight_class }}</td>
                            <td>{{ seconds }}</td>
                            <td>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-info" role="progressbar"
                                         style="width: {{ (seconds / max_val) * 100 }}%;">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Most common submission techniques -->
            <div class="mb-5" id="submission-techniques">
              <h4 class="mb-3">
                <i class="fas fa-handshake-angle text-info"></i> Most common submission techniques
              </h4>
            
              <!-- Limitation notice -->
              <div class="alert alert-warning d-flex align-items-start gap-3" role="alert">
                <i class="fas fa-triangle-exclamation fs-4 mt-1"></i>
                <div>
                  <strong>Data limitation:</strong> Although the initial objective included analyzing the most common submission techniques,
                  the dataset used does <em>not</em> specify the submission type (e.g., rear-naked choke, triangle choke, kimura). Therefore,
                  this analysis could not be performed with the available data.
                </div>
              </div>
            
              <!-- Context and what would be needed -->
              <div class="card border-0 shadow-sm">
                <div class="card-body">
                  <h6 class="card-title mb-2">What’s missing?</h6>
                  <p class="mb-3 text-muted small">
                    The current fields only indicate the high-level <code>method</code> (e.g., Submission) without a breakdown of the specific technique.
                  </p>
            
                  <div class="row g-3">
                    <div class="col-12 col-md-7">
                      <h6 class="mb-2"><i class="fas fa-database text-secondary"></i> Data required for this analysis</h6>
                      <ul class="mb-0">
                        <li>Submission technique name (e.g., <em>Rear-Naked Choke</em>, <em>Armbar</em>, <em>Guillotine</em>)</li>
                        <li>Standardized taxonomy or mapping to avoid duplicates/synonyms</li>
                        <li>(Optional) Attempt counts per technique for deeper insights</li>
                      </ul>
                    </div>
                    <div class="col-12 col-md-5">
                      <h6 class="mb-2"><i class="fas fa-lightbulb text-secondary"></i> Next steps</h6>
                      <ol class="mb-0">
                        <li>Augment dataset with a <code>submission_technique</code> column</li>
                        <li>Normalize technique names (e.g., mapping table)</li>
                        <li>Compute frequency and share by technique and by weight class</li>
                      </ol>
                    </div>
                  </div>
                </div>
              </div>
            
              <!-- Optional placeholder for future chart -->
              <div class="text-center mt-4">
                <div class="border rounded p-4 text-muted">
                  <i class="fas fa-chart-pie d-block mb-2"></i>
                  <span class="small">Placeholder for a “Top submission techniques” chart — will render once technique-level data is available.</span>
                  <!-- <canvas id="submissionTechniquesChart" height="200"></canvas> -->
                </div>
              </div>
            </div>

        </section>

         {{ content | safe }}
      </div>
   </body>
   <script>
      function setupDistFightsPerWeightChart(){
          const distFightsPerWeightChart = document.getElementById('distFightsPerWeightChart');
          const distFightsPerWeightChartData = {{ dist_fights_per_weight_chart | safe }};
          new Chart(distFightsPerWeightChart, {
              type: 'line',
              data: distFightsPerWeightChartData,
              options: { 
              responsive: true,
              plugins: {
                  legend: {
                      onClick: (e, legendItem, legend) => {
                          const index = legendItem.datasetIndex;
                          const ci = legend.chart;
                          const meta = ci.getDatasetMeta(index);
      
                          // Alterna visibilidade
                          meta.hidden = meta.hidden === null ? !ci.data.datasets[index].hidden : null;
                          ci.update();
                      }
                  }
              }
          }
        });
      }

       function setupKoSubmissionDecisionMethodsChart(){
            const koSubmissionDecisionMethodsData = {{ ko_submission_decision_methods_chart | safe }};
           const ctx = document.getElementById('winRatioChart');
            const data = {
                labels: Object.keys(koSubmissionDecisionMethodsData),
                datasets: [{
                    data: Object.values(koSubmissionDecisionMethodsData),
                    backgroundColor: ['#dc3545', '#28a745', '#007bff'],
                    hoverOffset: 10
                }]
            };
            new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let value = context.parsed;
                                    let total = context.chart._metasets[context.datasetIndex].total;
                                    let percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value} fights (${percentage}%)`;
                                }
                            }
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
       }
      
        setupDistFightsPerWeightChart();
        setupKoSubmissionDecisionMethodsChart();
      
   </script>
</html>