<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
   <link rel="stylesheet" type='text/css'
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" />
   <link rel="stylesheet" type="text/css" href="ufc_report.css" />
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <title>{{ title }}</title>
</head>


<body>
   <!-- Mobile Toggle Button -->
   <button class="mobile-toggle d-md-none" type="button" onclick="toggleSidebar()">
      <i class="fas fa-bars"></i>
   </button>
   <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
         <h4 class="menu-title"><img src="{{ ufc_logo_url }}" alt="UFC Logo" class="title-image"></i>Analytics</h4>
      </div>
      <nav class="sidebar-nav">
         <ul class="nav flex-column">
            <li class="nav-item">
               <a class="nav-link active" href="#" data-section="overview">
                  <i class="fas fa-home"></i>
                  Overview
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="history">
                  <i class="fas fa-history"></i>
                  Historical Overview
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="statistics">
                  <i class="fas fa-chart-pie"></i>
                  Fight Statistics
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="top-fighters">
                  <i class="fas fa-trophy"></i>
                  Top Fighters
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="influences">
                  <i class="fas fa-chart-line"></i>
                  Fight Influences
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="rivalries">
                  <i class="fas fa-sword-cross"></i>
                  Rivalries
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="trilogies">
                  <i class="fas fa-medal"></i>
                  Trilogies
               </a>
            </li>
         </ul>
      </nav>
   </div>
   <!-- Main Content -->
   <div class="main-content">
      {% include "sections/overview_section.html" with context %}
   </div>
</body>
<script>
   function setupDistFightsPerWeightChart() {
      const distFightsPerWeightChart = document.getElementById('distFightsPerWeightChart');
      const distFightsPerWeightChartData = {{ data["fights_per_year_division"] | safe
   }};
   new Chart(distFightsPerWeightChart, {
      type: 'line',
      data: distFightsPerWeightChartData,
      options: {
         responsive: true,
         plugins: {
            legend: {
               onClick: (e, legendItem, legend) => {
                  const index = legendItem.datasetIndex;
                  const ci = legend.chart;
                  const meta = ci.getDatasetMeta(index);

                  // Alterna visibilidade
                  meta.hidden = meta.hidden === null ? !ci.data.datasets[index].hidden : null;
                  ci.update();
               }
            }
         }
      }
   });
      }

   function setupKoSubmissionDecisionMethodsChart() {
      const koSubmissionDecisionMethodsData = {{ data["ko_submission_decision_methods"]["chart"] | safe
   }};
   const ctx = document.getElementById('winRatioChart');
   const data = {
      labels: Object.keys(koSubmissionDecisionMethodsData),
      datasets: [{
         data: Object.values(koSubmissionDecisionMethodsData),
         backgroundColor: ['#dc3545', '#28a745', '#007bff'],
         hoverOffset: 10
      }]
   };
   new Chart(ctx, {
      type: 'doughnut',
      data: data,
      options: {
         responsive: true,
         plugins: {
            tooltip: {
               callbacks: {
                  label: function (context) {
                     let value = context.parsed;
                     let total = context.chart._metasets[context.datasetIndex].total;
                     let percentage = ((value / total) * 100).toFixed(1);
                     return `${context.label}: ${value} fights (${percentage}%)`;
                  }
               }
            },
            legend: {
               position: 'bottom'
            }
         }
      }
   });
       }

   function datesToFormat() {
      const dates = document.getElementsByClassName("date-to-format");
      for (date = 0; date < dates.length; date++) {
         const dateEl = dates[date];
         dateEl.innerHTML = dateEl.innerHTML.split(" ")[0];
      }
   }

   function upperFirst() {
      const elements = document.getElementsByClassName("upper-first");
      for (elementIdx = 0; elementIdx < elements.length; elementIdx++) {
         const element = elements[elementIdx];
         const result = element
            .innerHTML
            .split(" ")
            .map(palavra => palavra.charAt(0).toUpperCase() + palavra.slice(1))
            .join(" ");
         element.innerHTML = result;
      }
   }

   function secToMinAndSec() {
      const elements = document.getElementsByClassName("sec-to-min-and-sec");
      for (elementIdx = 0; elementIdx < elements.length; elementIdx++) {
         const element = elements[elementIdx];
         const time = element.innerHTML.trim();
         const totalSeconds = parseInt(time, 10);

         const minutes = Math.floor(totalSeconds / 60);
         const seconds = totalSeconds % 60;

         let result = [];


         if (minutes > 0) {
            result.push(`${minutes} minute${minutes > 1 ? 's' : ''}`);
         }


         if (seconds > 0) {
            result.push(`${seconds} second${seconds > 1 ? 's' : ''}`);
         }


         if (result.length === 0) {
            result.push(`0 seconds`);
         }
         element.innerHTML = result.join(" ")
      }
   }

   setupDistFightsPerWeightChart();
   setupKoSubmissionDecisionMethodsChart();
   datesToFormat();
   upperFirst();
   secToMinAndSec();

</script>

</html>