<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
   <link rel="stylesheet" type='text/css'
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" />
   <link rel="stylesheet" type="text/css" href="ufc_report.css" />
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <title>{{ title }}</title>
</head>


<body>
   <!-- Mobile Toggle Button -->
   <button class="mobile-toggle d-md-none" type="button" onclick="toggleSidebar()">
      <i class="fas fa-bars"></i>
   </button>
   <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
         <h4 class="menu-title"><img src="{{ ufc_logo_url }}" alt="UFC Logo" class="title-image"></i>Analytics</h4>
      </div>
      <nav class="sidebar-nav">
         <ul class="nav flex-column">
            <li class="nav-item">
               <a class="nav-link active" href="#" data-section="overview">
                  <i class="fas fa-home"></i>
                  Overview
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="history">
                  <i class="fas fa-history"></i>
                  Historical Overview
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="statistics">
                  <i class="fas fa-chart-pie"></i>
                  Fight Statistics
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="fighters-statistics">
                  <i class="fas fa-trophy"></i>
                  Fighters Statistics
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="influences">
                  <i class="fas fa-chart-line"></i>
                  Fight Influences
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="rivalries">
                  <i class="fas fa-users"></i>
                  Rivalries
               </a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="#" data-section="trilogies">
                  <i class="fas fa-medal"></i>
                  Trilogies
               </a>
            </li>
         </ul>
      </nav>
   </div>
   <!-- Main Content -->
   <div class="main-content">
      {% include "sections/overview.html" with context %}
      {% include "sections/historical_overview.html" with context %}
      {% include "sections/fight_statistics.html" with context %}
      {% include "sections/top_fighters.html" with context %}
      {% include "sections/fight_influences.html" with context %}
      {% include "sections/rivalries.html" with context %}
      {% include "sections/trilogies.html" with context %}
   </div>
   <!-- Footer -->
   <footer class="mt-5 py-4 bg-dark text-light">
      <div class="container text-center small">
         <p class="mb-1">
            üìä UFC Data Analysis Report ‚Äî Generated on <strong>{{ processed_date }}</strong>
         </p>
         <p class="mb-2">
            Built with <i class="fab fa-python text-warning"></i> Python & <i class="fas fa-chart-bar text-info"></i>
            Chart.js
         </p>
         <div class="d-flex justify-content-center gap-3">
            <a href="{{ github_link }}" target="_blank" class="text-light">
               <i class="devicon-github-original"></i> GitHub
            </a>
            <a href="{{ kaggle_link }}" target="_blank" class="text-light">
               <i class="devicon-kaggle-original"></i> Kaggle Dataset
            </a>
         </div>
         <hr class="border-secondary my-3">
         <p class="mb-0 text">
            ‚ö†Ô∏è This study is exploratory and intended for educational purposes.
            UFC¬Æ is a registered trademark of Zuffa, LLC.
         </p>
      </div>
   </footer>
</body>
<script>
   // Navigation functionality
   function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.section').forEach(section => {
         section.classList.remove('active');
      });

      // Show selected section
      document.getElementById(sectionId).classList.add('active');

      // Update navigation
      document.querySelectorAll('.nav-link').forEach(link => {
         link.classList.remove('active');
      });
      document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
   }

   // Add click listeners to navigation
   document.querySelectorAll('[data-section]').forEach(link => {
      link.addEventListener('click', (e) => {
         e.preventDefault();
         const sectionId = e.currentTarget.getAttribute('data-section');
         showSection(sectionId);
      });
   });

   // Mobile sidebar toggle
   function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('show');
   }

   // Chart setup functions

   function setupEventsPerYearChart() {
      const ctx = document.getElementById('fightsPerYearChart').getContext('2d');
      new Chart(ctx, {
         type: 'line',
         data: {
            labels: {{ data["events_per_year"].keys() | list | safe }}, // years
   datasets: [{
      label: 'Fights per Year',
      data: {{ data["events_per_year"].values() | list | safe }}, // counts
      borderColor: 'rgba(75, 192, 192, 1)',
      backgroundColor: 'rgba(75, 192, 192, 0.2)',
      fill: true,
      tension: 0.3
               }]
            },
   options: {
      responsive: true,
         plugins: {
         legend: { display: false },
      },
      scales: {
         x: { title: { display: true, text: 'Year' } },
         y: { title: { display: true, text: 'Number of Fights' } }
      }
   }
         });
      }

   function setupPerformanceByAgeChart() {
      // Recebendo os dados do Python (via Jinja, por exemplo)
      const perfData = {{ data["performance_by_age"] | tojson
   }};

   // Extraindo arrays de idades e win_rate
   const ages = Object.values(perfData.age);
   const winRates = Object.values(perfData.win_rate);

   const ctx = document.getElementById('performanceByAgeChart').getContext('2d');
   new Chart(ctx, {
      type: 'line',
      data: {
         labels: ages,
         datasets: [{
            label: 'Win Rate',
            data: winRates,
            borderColor: 'rgba(75, 192, 192, 1)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            tension: 0.3,
            pointRadius: 3,
            pointHoverRadius: 5,
            fill: true
         }]
      },
      options: {
         responsive: true,
         plugins: {
            tooltip: {
               callbacks: {
                  label: function (context) {
                     return (context.raw * 100).toFixed(1) + "%";
                  }
               }
            },
            legend: {
               display: false
            }
         },
         scales: {
            y: {
               beginAtZero: true,
               max: 1,
               ticks: {
                  callback: function (value) {
                     return (value * 100) + "%";
                  }
               },
               title: {
                  display: true,
                  text: "Win Rate (%)"
               }
            },
            x: {
               title: {
                  display: true,
                  text: "Age"
               }
            }
         }
      }
   });
   }

   function setupDistFightsPerWeightChart() {
      const ctx = document.getElementById('distFightsPerWeightChart');
      const data = {
         labels: [1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025],
         datasets: [
            {
               label: "Heavyweight",
               data: [185, 60, 140, 89, 80, 87, 106, 56, 88, 231, 146, 210, 252, 331, 265, 299, 330, 326, 331, 484, 460, 400, 489, 498, 448, 441, 411, 395, 240],
               borderColor: '#d41515',
               backgroundColor: 'rgba(212, 21, 21, 0.1)'
            },
            {
               label: "Light Heavyweight",
               data: [7, 25, 8, 13, 64, 67, 34, 46, 115, 286, 283, 297, 387, 356, 385, 302, 382, 328, 313, 450, 468, 466, 572, 406, 468, 437, 433, 424, 309],
               borderColor: '#000000',
               backgroundColor: 'rgba(0, 0, 0, 0.1)'
            },
            {
               label: "Middleweight",
               data: [0, 59, 96, 85, 40, 93, 57, 61, 204, 296, 248, 454, 391, 548, 475, 508, 652, 635, 642, 692, 643, 540, 556, 500, 760, 785, 689, 733, 614],
               borderColor: '#6c757d',
               backgroundColor: 'rgba(108, 117, 125, 0.1)'
            },
            {
               label: "Welterweight",
               data: [0, 8, 15, 68, 80, 97, 58, 94, 188, 361, 368, 461, 600, 688, 596, 686, 806, 931, 990, 1137, 843, 975, 942, 632, 716, 761, 740, 789, 447],
               borderColor: '#17a2b8',
               backgroundColor: 'rgba(23, 162, 184, 0.1)'
            },
            {
               label: "Lightweight",
               data: [99, 48, 44, 49, 56, 61, 74, 48, 0, 164, 470, 554, 619, 677, 704, 738, 889, 1194, 1125, 1055, 818, 859, 923, 561, 783, 823, 943, 824, 547],
               borderColor: '#28a745',
               backgroundColor: 'rgba(40, 167, 69, 0.1)'
            }
         ]
      };

      new Chart(ctx, {
         type: 'line',
         data: data,
         options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
               legend: {
                  position: 'bottom'
               }
            },
            scales: {
               y: {
                  beginAtZero: true
               }
            }
         }
      });
   }

   function setupWinRatioChart(data) {
      const ctx = document.getElementById('winRatioChart');
      const chartData = {{ data["ko_submission_decision_methods"]["chart"] }};

      const labels = Object.keys(chartData); 
      const values = Object.values(chartData); 

      const dataset = {
         labels: labels,
         datasets: [{
            data: values,
            backgroundColor: ['#d41515', '#28a745', '#007bff'],
            hoverOffset: 10
         }]
      };

      new Chart(ctx, {
         type: 'doughnut',
         data: dataset,
         options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
               tooltip: {
                  callbacks: {
                     label: function (context) {
                        let value = context.parsed;
                        let total = context.chart._metasets[context.datasetIndex].total;
                        let percentage = ((value / total) * 100).toFixed(1);
                        return `${context.label}: ${value} fights (${percentage}%)`;
                     }
                  }
               },
               legend: {
                  position: 'bottom'
               }
            }
         }
      });
   }


   // Initialize charts when DOM is loaded
   document.addEventListener('DOMContentLoaded', function () {
      setupEventsPerYearChart();
      setupDistFightsPerWeightChart();
      setupWinRatioChart();
      setupPerformanceByAgeChart();
   });
</script>

</html>