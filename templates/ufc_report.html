<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
      <link rel="stylesheet" type='text/css' href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css" />
      <link rel="stylesheet" type='text/css' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" />
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <title>{{ title }}</title>
      <style>
         header {
         background-color: #000;
         color: #fff;
         }
         header img {
         height: 60px;
         }
         .intro {
         background-color: #f8f9fa;
         border-left: 5px solid #dc3545;
         }
         #rivalries {
         padding: 20px;
         }
         .rivalry-card {
         border: 1px solid #ccc;
         border-radius: 12px;
         margin-bottom: 30px;
         padding: 15px;
         background-color: #f9f9f9;
         }
         .fights-container {
         display: flex;
         flex-direction: column;
         gap: 15px;
         }
         .fight-card {
         border: 1px solid #ddd;
         border-radius: 10px;
         padding: 10px;
         background-color: #fff;
         }
         .fighters {
         display: flex;
         align-items: center;
         justify-content: center;
         gap: 10px;
         margin-bottom: 10px;
         }
         .fighter {
         text-align: center;
         }
         .fighter img {
         width: 60px;
         height: 60px;
         border-radius: 50%;
         object-fit: cover;
         margin-bottom: 5px;
         }
         .vs {
         font-weight: bold;
         font-size: 18px;
         }
      </style>
   </head>
   <body>
      <!-- Header -->
      <header class="py-3 shadow-sm">
         <div class="container d-flex align-items-center">
            <img src="{{ ufc_logo_url }}" alt="UFC Logo" class="me-3">
            <h1 class="h3 mb-0">{{ title }}</h1>
         </div>
      </header>
      <!-- Main container -->
      <div class="container my-4">
         <!-- Meta info -->
         <p class="text-muted small mb-4">
            <strong>Processed on:</strong> {{ processed_date }}
         </p>
         <!-- Intro section -->
         <div class="intro p-4 mb-4 rounded shadow-sm">
            <p class="mb-3">
               This report presents a detailed analysis of UFC fight data, exploring relevant statistics, trends, and insights.
               The goal is to understand performance patterns, fighting styles, and results over time.
            </p>
            <div class="d-flex flex-wrap gap-2">
               <a href="{{ kaggle_link }}" target="_blank" class="btn btn-outline-primary btn-sm">
               <i class="devicon-kaggle-original"></i> Kaggle Dataset
               </a>
               <a href="{{ github_link }}" target="_blank" class="btn btn-outline-dark btn-sm">
               <i class="devicon-github-original"></i> GitHub Codebase
               </a>
            </div>
         </div>
         <hr class="my-4">
         <!-- UFC Historical Overview Section -->
         <section class="mb-5">
            <h2 class="mb-4">
               <i class="fas fa-history text-danger"></i> UFC Historical Overview
            </h2>
            <!-- Evolution of the number of fights per year -->
            <div class="mb-5">
               <h4 class="mb-3">
                  <i class="fas fa-chart-line text-primary"></i> Evolution of the number of fights per year
               </h4>
               <div class="text-center">
                  <img src="images/chart-1.png" alt="Evolution of fights per year" class="img-fluid rounded shadow-sm">
                  <p class="text-muted small mt-2">Figure 1: Number of UFC fights per year (historical trend)</p>
               </div>
            </div>
            <!-- Most frequent host countries and cities -->
            <div class="mb-5">
               <h4 class="mb-3">
                  <i class="fas fa-map-marker-alt text-success"></i> Most frequent host countries and cities
               </h4>
               <!-- Countries -->
               <div class="mb-4">
                  <p>
                     Over the years, UFC has hosted events in multiple countries, but certain nations have dominated the scene.
                     Below are the top host countries by number of events.
                  </p>
                  <!-- Example table -->
                  <table class="table table-striped table-bordered table-sm">
                     <thead class="table-dark">
                        <tr>
                           <th>Rank</th>
                           <th>Country</th>
                           <th>Events Hosted</th>
                        </tr>
                     </thead>
                     <tbody>
                        {% set ns = namespace(index_cnt = 1) -%}
                        {% for country in countries.keys() -%}
                        <tr>
                           <td>{{ ns.index_cnt }}</td>
                           <td>{{ country }}</td>
                           <td>{{ countries[country] }}</td>
                           {% set ns.index_cnt = ns.index_cnt + 1 %}
                        </tr>
                        {% endfor %}
                     </tbody>
                  </table>
               </div>
               <!-- Cities -->
               <div>
                  <p>
                     These are the top 5 cities with the most UFC events.
                  </p>
                  <div class="row g-4">
                     {% set ns = namespace(index_cnt = 1) -%}
                     {% for city in cities.keys() -%}
                     <div class="col-6 col-md-4 col-lg-2 text-center">
                        <img src="images/city{{ns.index_cnt}}.jpg" alt="{{ city }}" class="img-fluid rounded shadow-sm"">
                        <p class="mt-2 mb-0 fw-bold">{{ city }}</p>
                        <p class="mt-2 mb-0 fw-bold">{{ cities[city] }} events</p>
                     </div>
                     {% set ns.index_cnt = ns.index_cnt + 1 %}
                     {% endfor %}
                  </div>
               </div>
            </div>
            <!-- Distribution of fights per weight class over time -->
            <div>
               <h4 class="mb-3">
                  <i class="fas fa-dumbbell text-warning"></i> Distribution of fights per weight class over time
               </h4>
               <p>
                  The graph below shows how fights have been distributed across weight classes throughout UFC history.
               </p>
               <div class="text-center">
                  <div>
                     <canvas id="distFightsPerWeightChart"></canvas>
                  </div>
                  <p class="text-muted small mt-2">Figure 2: Weight class distribution over time</p>
               </div>
            </div>
         </section>
         <!-- General Fight Statistics -->
         <section class="mb-5">
            <h2 class="mb-4">
               <i class="fas fa-chart-pie text-danger"></i> General Fight Statistics
            </h2>
            <!-- Win ratio by method -->
            <div class="mb-5">
               <h4 class="mb-3">
                  <i class="fas fa-trophy text-warning"></i> Win ratio by method
               </h4>
               <p>
                  This chart shows the proportion of fight outcomes by method ‚Äî Knockout/Technical Knockout (KO/TKO), Submission, and Decision.
               </p>
               <div class="row align-items-center">
                  <div class="col-md-6 text-center">
                     <canvas id="winRatioChart" style="max-height: 300px;"></canvas>
                     <p class="text-muted small mt-2">Figure 3: Win ratio distribution</p>
                  </div>
                  <div class="col-md-6">
                     <ul class="list-group shadow-sm">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                           <span><i class="fas fa-hand-rock text-success"></i> KO/TKO</span>
                           <span class="badge bg-success rounded-pill">{{ ko_submission_decision_methods_props[1] }}%</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                           <span><i class="fas fa-link text-primary"></i> Submission</span>
                           <span class="badge bg-primary rounded-pill">{{ ko_submission_decision_methods_props[2] }}%</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                           <span><i class="fas fa-clipboard-check text-danger"></i> Decision</span>
                           <span class="badge bg-danger rounded-pill">{{ ko_submission_decision_methods_props[0] }}%</span>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <!-- Average fight duration per weight class -->
            <div class="mb-5">
               <h4 class="mb-3">
                  <i class="fas fa-stopwatch text-info"></i> Average fight duration per weight class
               </h4>
               <p>
                  This table shows the average fight duration for each weight class.  
                  The bars visually represent the relative length of the fights.
               </p>
               <table class="table table-bordered align-middle">
                  <thead class="table-dark">
                     <tr>
                        <th>Weight Class</th>
                        <th>Average Duration (seconds)</th>
                        <th>Visual</th>
                     </tr>
                  </thead>
                  <tbody>
                     {% set max_val = duration_by_weight_class.values() | max %}
                     {% for weight_class, seconds in duration_by_weight_class.items() %}
                     <tr>
                        <td>{{ weight_class }}</td>
                        <td>{{ seconds }}</td>
                        <td>
                           <div class="progress" style="height: 20px;">
                              <div class="progress-bar bg-info" role="progressbar"
                                 style="width: {{ (seconds / max_val) * 100 }}%;">
                              </div>
                           </div>
                        </td>
                     </tr>
                     {% endfor %}
                  </tbody>
               </table>
            </div>
            <!-- Average Strikes Leaders Section -->
            <div class="mb-5">
               <h2 class="mb-4">
                  <i class="fas fa-hand-rock text-danger"></i> Top 5 Fights by Striking Activity
               </h2>
               <p>
                  Below are the five fights with the highest average strikes, measured both per minute and per round.
                  These bouts showcase the most action-packed performances in UFC history.
               </p>
               <div class="row g-4">
                  {% for fight in top_strike_fights %}
                  <div class="col-12">
                     <div class="card shadow-sm border-0">
                        <div class="row g-0">
                           <!-- Fighter 1 -->
                           <div class="col-md-2 text-center p-2">
                              <img src="images/fighter{{ loop.index }}_1.jpg" alt="{{ fight.r_name }}" class="img-fluid rounded shadow-sm">
                              <p class="fw-bold mt-2 small">{{ fight.r_name }}</p>
                           </div>
                           <!-- Fight details -->
                           <div class="col-md-8 p-3 text-center">
                              <h5 class="card-title mb-1">{{ fight.event_name }}</h5>
                              <p class="text-muted small mb-1 date-to-format">{{ fight.date }} ‚Äî {{ fight.localization }}</p>
                              <p class="mb-1 upper-first"><strong>Division:</strong> {{ fight.division }}</p>
                              <p class="mb-1"><strong>Method:</strong> {{ fight.method }}</p>
                              <p class="mb-0"><strong>Fight Duration:</strong> <span class="sec-to-min-and-sec">{{ fight.match_time_sec }}</span></p>
                           </div>
                           <!-- Fighter 2 -->
                           <div class="col-md-2 text-center p-2">
                              <img src="images/fighter{{ loop.index }}_2.jpg" alt="{{ fight.b_name }}" class="img-fluid rounded shadow-sm">
                              <p class="fw-bold mt-2 small">{{ fight.b_name }}</p>
                           </div>
                        </div>
                        <!-- Stats footer -->
                        <div class="card-footer bg-light d-flex justify-content-around text-center">
                           <div>
                              <span class="fw-bold text-danger" style="font-size: 1.4em;">{{ fight.avg_str_min }}</span><br>
                              <small>Avg Strikes / Min</small>
                           </div>
                           <div>
                              <span class="fw-bold text-primary" style="font-size: 1.4em;">{{ fight.avg_str_rnd }}</span><br>
                              <small>Avg Strikes / Round</small>
                           </div>
                        </div>
                     </div>
                  </div>
                  <hr/>
                  {% endfor %}
               </div>
            </div>
            <!-- Top 10 Fighters with the Most Wins -->
            <div class="mb-5">
               <h2 class="mb-4">
                  <i class="fas fa-trophy text-warning"></i> Top 10 Fighters with the Most Wins
               </h2>
               <p>
                  These fighters have achieved legendary status in MMA history, amassing the highest number of career victories.
               </p>
               <div class="row g-4">
                  {% for fighter in top_10_fighters_with_the_most_wins %}
                  <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
                     <div class="card shadow-sm border-0 h-100 text-center p-3">
                        <img src="images/fighter_top_10_wins{{ loop.index }}.jpg" 
                           alt="{{ fighter.name }}" 
                           class="img-fluid rounded-circle mx-auto mb-3" 
                           style="width:100px;height:100px;object-fit:cover;">
                        <h5 class="mb-1">{{ fighter.name }}</h5>
                        <div class="text-center d-flex flex-column align-items-center justify-content-between" style="height: 60px;">
                           {% set nickname = '' if fighter.nick_name|trim|lower == 'nan' else fighter.nick_name %}
                           {% if nickname %}
                           <small class="text-muted fst-italic">"{{ nickname }}"</small>
                           {% else %}
                           <span style="visibility: hidden;">Placeholder</span>
                           {% endif %}
                           <span class="badge bg-success fs-6 px-3 py-2">
                           {{ fighter.wins }} Wins
                           </span>
                        </div>
                     </div>
                  </div>
                  {% endfor %}
               </div>
            </div>
            <!-- Fighters with Highest KO Rate Section -->
            <div class="mb-5">
               <h2 class="mb-4">
                  <i class="fas fa-fist-raised text-danger"></i> Fighters with the Highest KO Rate
               </h2>
               <p>
                  Top 10 fighters ranked by their knockout rate, showing efficiency in finishing fights by KO/TKO.
               </p>
               <div class="row g-4">
                  {% for fighter in top_10_fighters_with_the_most_ko_rate %}
                  <div class="col-12 col-md-6 col-lg-4">
                     <div class="card shadow-sm border-0 h-100">
                        <div class="text-center p-3">
                           <!-- Fighter Image -->
                           <img src="images/fighter_ko_{{ loop.index }}.jpg" alt="{{ fighter.winner }}" class="img-fluid rounded shadow-sm mb-2" style="max-height: 180px;">
                           <!-- Fighter Name -->
                           <h5 class="fw-bold mb-1">{{ fighter.winner }}</h5>
                           <!-- KO Wins / Total Wins -->
                           <p class="text-muted mb-2">{{ fighter.ko_wins }} KO Wins / {{ fighter.total_wins }} Total Wins</p>
                           <!-- KO Rate Bar -->
                           <div class="progress" style="height: 20px;">
                              <div class="progress-bar bg-danger" role="progressbar" 
                                 style="width: {{ (fighter.ko_rate * 100)|round(1) }}%;" 
                                 aria-valuenow="{{ (fighter.ko_rate * 100)|round(1) }}" aria-valuemin="0" aria-valuemax="100">
                                 {{ (fighter.ko_rate * 100)|round(1) }}%
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  {% endfor %}
               </div>
            </div>
            <!-- Performance Comparison by Age Section -->
            <div class="mb-5">
               <h4 class="mb-3">
                  <i class="fas fa-user-clock text-info"></i> Performance Comparison by Age
               </h4>
               <p>
                  This chart illustrates how fighters' performance varies with age, highlighting trends in win rates, striking efficiency, and fight outcomes over time.
               </p>
               <!-- Chart -->
               <div class="text-center mb-3">
                  <img src="images/chart-2.png" alt="Performance Comparison by Age" class="img-fluid rounded shadow-sm">
                  <p class="text-muted small mt-2">Figure: Win rate by age</p>
               </div>
               <!-- Disclaimer -->
               <div class="alert alert-warning shadow-sm" role="alert">
                  <h6 class="fw-bold">‚ö†Ô∏è Disclaimer: How the Win Rate by Age is Calculated</h6>
                  <p>
                     The <code>win_rate</code> (win percentage by age) is computed by analyzing fighters' outcomes based on their age at the time of each fight.
                     The dataset was transformed into a long format, where each row represents <strong>one fighter per fight</strong> (instead of one row per fight with two fighters). 
                     This allows us to associate each fighter with their age and match outcome individually.
                  </p>
                  <p>
                     The win rate for each age is calculated as: <br>
                     <strong>Number of fights won by fighters at a given age √∑ Total number of fights fought at that same age</strong>
                  </p>
                  <p>
                     For example, if fighters who were 30 years old won 60 out of 100 fights, the win rate at age 30 is 0.60.
                  </p>
                  <hr>
                  <p class="mb-0">
                     <strong>Important Notes:</strong>
                  <ul class="mb-0">
                     <li>This does <strong>not</strong> account for opponent strength, fight context, or event level.</li>
                     <li>Ages with very few fights may result in misleading rates due to low sample size.</li>
                  </ul>
                  </p>
               </div>
            </div>
            <!-- Average Career Length of Fighters Section -->
            <div class="mb-5">
               <h4 class="mb-3">
                  <i class="fas fa-hourglass-half text-danger"></i> Average Career Length of Fighters
               </h4>
               <p>
                  This metric represents the average duration of a professional UFC fighter's career, measured in years.
               </p>
               <div class="d-flex justify-content-center align-items-center my-4">
                  <div class="card text-center shadow-sm" style="width: 12rem;">
                     <div class="card-body">
                        <i class="fas fa-clock fa-3x text-primary mb-3"></i>
                        <h2 class="card-title display-5 fw-bold">{{ average_career_length_years }}</h2>
                        <p class="card-text text-muted">Years</p>
                     </div>
                  </div>
               </div>
               <p class="text-muted small text-center">
                  Note: This average is computed based on available fight data and may not account for retired fighters with incomplete historical records.
               </p>
            </div>
         </section>
         <!-- üìä What Influences a Fight Outcome? -->
         <section class="mt-5">
            <h3 class="mb-3">üìä What Influences a Fight Outcome?</h3>
            <div class="card shadow-sm border-0">
               <div class="card-body">
                  <p class="mb-3">
                     <i class="fas fa-lightbulb text-warning me-2"></i>
                     <strong>Insight:</strong> The analysis explores how physical attributes might correlate with a fighter's chance of winning.
                  </p>
                  <div class="alert alert-info mb-0">
                     <i class="fas fa-chart-line me-2"></i>
                     {{ influences_fight_outcome }}
                  </div>
               </div>
            </div>
         </section>
         <!-- Does Making Weight Increase Win Chances Section -->
         <section class="mt-5">
            <h4 class="mb-3">
               <i class="fas fa-weight-hanging text-primary"></i> Does Making Weight Increase Win Chances?
            </h4>
            <p>
               The table below shows the win probabilities for fighters based on whether they successfully made weight. 
               Fighters who made weight have a significantly higher chance of winning.
            </p>
            <table class="table table-bordered table-striped w-50">
               <thead class="table-dark">
                  <tr>
                     <th>Made Weight</th>
                     <th>Win Probability</th>
                  </tr>
               </thead>
               <tbody>
                  {% for row in made_weight_stats %}
                  <tr>
                     <td>{{ row.made_weight }}</td>
                     <td>{{ (row.won * 100) | round(1) }}%</td>
                  </tr>
                  {% endfor %}
               </tbody>
            </table>
            <p class="text-muted small mt-2">
               Fighters who made weight nearly doubled their winning probability compared to those who missed weight.
            </p>
         </section>
         <section class="mt-5">
            <h4 class="mb-3">
               <i class="fas fa-running text-success"></i> Do Fighters Coming Off a Win Have a Higher Chance of Winning Again?
            </h4>
            <p>
               This analysis explores whether winning a fight increases the probability of winning the subsequent fight.
            </p>
            <table class="table table-bordered table-striped w-50">
               <thead class="table-dark">
                  <tr>
                     <th>Previous Fight Outcome</th>
                     <th>Win Probability</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>Won Previous Fight</td>
                     <td>{{ (win_rate_after_win * 100) | round(1) }}%</td>
                  </tr>
                  <tr>
                     <td>Lost Previous Fight</td>
                     <td>{{ (win_rate_after_loss * 100) | round(1) }}%</td>
                  </tr>
               </tbody>
            </table>
            <p class="text-muted small mt-2">
               Fighters coming off a win have a slightly higher probability of winning again ({{ (win_rate_after_win * 100) | round(1) }}%) compared to those coming off a loss ({{ (win_rate_after_loss * 100) | round(1) }}%).
               While the difference is not huge, it suggests a minor momentum effect in fight outcomes.
            </p>
         </section>
         <section id="rivalries">
            <h2>‚öîÔ∏è Rivalries & Rematches</h2>
            {% for rivalry in rivalries %}
            <div class="rivalry-card">
               <!-- Topo com fotos, nomes e n√∫mero de vit√≥rias -->
               <div class="rivalry-header" style="display: flex; align-items: center; justify-content: center; gap: 40px; margin-bottom: 20px;">
                  <!-- Lutador 1 -->
                  <div class="fighter" style="text-align: center;">
                     {% if rivalry.r_image %}
                     <img src="{{ rivalry.r_image }}" alt="{{ rivalry.fights[0].r_name }}" style="width:120px; height:120px; border-radius: 50%; object-fit: cover; border: 3px solid #333;">
                     {% endif %}
                     <p style="margin: 8px 0 4px; font-weight: bold;">{{ rivalry.fights[0].r_name }}</p>
                     <p style="margin:0; color:#f39c12; font-weight:bold;">
                        {% if  rivalry.r_wins > rivalry.b_wins %} üèÜ {% endif %} {{ rivalry.r_wins }}
                     </p>
                  </div>
                  <!-- VS -->
                  <div class="vs" style="font-size: 24px; font-weight: bold; color: #e74c3c;">VS</div>
                  <!-- Lutador 2 -->
                  <div class="fighter" style="text-align: center;">
                     {% if rivalry.b_image %}
                     <img src="{{ rivalry.b_image }}" alt="{{ rivalry.fights[0].b_name }}" style="width:120px; height:120px; border-radius: 50%; object-fit: cover; border: 3px solid #333;">
                     {% endif %}
                     <p style="margin: 8px 0 4px; font-weight: bold;">{{ rivalry.fights[0].b_name }}</p>
                     <p style="margin:0; color:#f39c12; font-weight:bold;">
                        {% if  rivalry.b_wins > rivalry.r_wins %} üèÜ {% endif %} {{ rivalry.b_wins }}
                     </p>
                  </div>
               </div>
               <!-- Sub-se√ß√£o com informa√ß√µes detalhadas de cada luta -->
                <div class="rivalry-fights" style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
  {% for fight in rivalry.fights %}
    <div class="fight-card" style="
      flex: 1 1 280px; 
      display: flex; 
      background: #ffffff; 
      color: #333; 
      padding: 15px; 
      border-radius: 12px; 
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-left: 5px solid #d32f2f;
      align-items: center;
    ">
      
      <!-- Coluna esquerda: n√∫mero da luta -->
      <div style="flex: 0 0 60px; text-align: center; font-size: 32px; font-weight: bold; color: #d32f2f;">
        {{ fight.fight_number }}
      </div>

      <!-- Coluna direita: informa√ß√µes -->
      <div style="flex: 1; padding-left: 10px; font-size: 14px;">
        
        <!-- Data -->
        <div style="margin-bottom: 6px; font-weight: bold; color: #555;">
          üìÖ {{ fight.date }}
        </div>

        <!-- Nome do evento -->
        <div style="margin-bottom: 6px; font-size: 15px;">
          üéØ <em>{{ fight.event_name }}</em>
        </div>

        <!-- Vencedor -->
        <div style="margin-bottom: 6px;">
          üèÜ <strong>Winner:</strong> 
          <span style="color: {% if fight.winner == rivalry.r_name %}#4caf50{% elif fight.winner == rivalry.b_name %}#2196f3{% else %}#ff9800{% endif %};">
            {{ fight.winner if fight.winner else "Draw/No Contest" }}
          </span>
        </div>

        <!-- M√©todo -->
        <div>
          ‚ö° <strong>Method:</strong> {{ fight.method }}
        </div>
      </div>

    </div>
  {% endfor %}
</div>


            </div>
            {% endfor %}
         </section>
         {{ content | safe }}
      </div>
   </body>
   <script>
      function setupDistFightsPerWeightChart(){
          const distFightsPerWeightChart = document.getElementById('distFightsPerWeightChart');
          const distFightsPerWeightChartData = {{ dist_fights_per_weight_chart | safe }};
          new Chart(distFightsPerWeightChart, {
              type: 'line',
              data: distFightsPerWeightChartData,
              options: { 
              responsive: true,
              plugins: {
                  legend: {
                      onClick: (e, legendItem, legend) => {
                          const index = legendItem.datasetIndex;
                          const ci = legend.chart;
                          const meta = ci.getDatasetMeta(index);
      
                          // Alterna visibilidade
                          meta.hidden = meta.hidden === null ? !ci.data.datasets[index].hidden : null;
                          ci.update();
                      }
                  }
              }
          }
        });
      }
      
       function setupKoSubmissionDecisionMethodsChart(){
            const koSubmissionDecisionMethodsData = {{ ko_submission_decision_methods_chart | safe }};
           const ctx = document.getElementById('winRatioChart');
            const data = {
                labels: Object.keys(koSubmissionDecisionMethodsData),
                datasets: [{
                    data: Object.values(koSubmissionDecisionMethodsData),
                    backgroundColor: ['#dc3545', '#28a745', '#007bff'],
                    hoverOffset: 10
                }]
            };
            new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let value = context.parsed;
                                    let total = context.chart._metasets[context.datasetIndex].total;
                                    let percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value} fights (${percentage}%)`;
                                }
                            }
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
       }
      
       function datesToFormat(){
           const dates = document.getElementsByClassName("date-to-format");
            for(date = 0; date < dates.length; date++){
                const dateEl = dates[date];
                dateEl.innerHTML = dateEl.innerHTML.split(" ")[0];
            }
       }
      
       function upperFirst(){
           const elements = document.getElementsByClassName("upper-first");
           for(elementIdx = 0; elementIdx < elements.length; elementIdx++){
                const element = elements[elementIdx];
                const result = element
                              .innerHTML
                              .split(" ")
                              .map(palavra => palavra.charAt(0).toUpperCase() + palavra.slice(1))
                              .join(" ");
               element.innerHTML = result;
            }
       }
      
       function secToMinAndSec(){
           const elements = document.getElementsByClassName("sec-to-min-and-sec");
           for(elementIdx = 0; elementIdx < elements.length; elementIdx++){
                const element = elements[elementIdx];
               const time = element.innerHTML.trim();
               const totalSeconds = parseInt(time, 10);
      
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                
                let result = [];
                
                
                if (minutes > 0) {
                  result.push(`${minutes} minute${minutes > 1 ? 's' : ''}`);
                }
                
                
                if (seconds > 0) {
                  result.push(`${seconds} second${seconds > 1 ? 's' : ''}`);
                }
                
                
                if (result.length === 0) {
                  result.push(`0 seconds`);
                }
                element.innerHTML = result.join(" ")
           }
       }
      
        setupDistFightsPerWeightChart();
        setupKoSubmissionDecisionMethodsChart();
        datesToFormat();
        upperFirst();
        secToMinAndSec();
      
   </script>
</html>